"use strict";angular.module("acesTester",["ngAnimate","ngCookies","ngTouch","ngResource","ui.router"]).config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(e,s,a){e.state("home",{url:"/",templateUrl:"partials/main.html",controller:"MainCtrl"}).state("search",{url:"/search",templateUrl:"partials/search.html",controller:"SearchCtrl"}),a.resourceUrlWhitelist(["self",/^https?:\/\/(goapi\.)?curtmfg.com/]),s.otherwise("/")}]),angular.module("acesTester").filter("filterResults",function(){return function(e){return e}}),angular.module("acesTester").filter("matchedParts",function(){return function(e,s){var a=!1,t=[],l=[],i=0,r=0;for(i=0;i<e.length;i++)l.push(e[i].PartId);var n=$(".filter-segment").get();for(i=0;i<n.length;i++){var o=n[i],c=[],d=$(o).find("li").get(),u=!1;for(r=0;r<d.length;r++){var g=d[r];$(g).find("input").is(":checked")&&(a=!0,u=!0,c=c.concat(s.filters[i].Options[r].Products))}if(u){var p=[];for(r=0;r<l.length;r++){var v=l[r];-1!==c.indexOf(v)&&p.push(v)}l=p}}if(!a)return s.displayable=e,e;for(i=0;i<e.length;i++){var h=e[i];-1!==l.indexOf(h.PartId)&&t.push(h)}return s.displayable=t,t}}),angular.module("acesTester").factory("lookupFactory",["$http","$q",function(e,s){var a={},t="https://goapi.curtmfg.com/vehicle?key=9300f7bc-2ca6-11e4-8758-42010af0fd79";return e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.post["Content-Type"]="application/json",a.query=function(a){var l=s.defer(),i=a;return e({method:"post",url:t,data:i,headers:{"Content-Type":"application/json; charset=UTF-8"},responseType:"json"}).success(l.resolve).error(l.reject),l.promise},a}]),angular.module("acesTester").factory("searchFactory",["$http","$q",function(e,s){var a={};return e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.post["Content-Type"]="application/json",a.query=function(a){var t=s.defer();return e({method:"get",url:"https://goapi.curtmfg.com/search/"+a+"?key=9300f7bc-2ca6-11e4-8758-42010af0fd79",responseType:"json"}).success(t.resolve).error(t.reject),t.promise},a}]),angular.module("acesTester").factory("categoryFactory",["$http","$q",function(e,s){var a={},t="https://goapi.curtmfg.com/",l="9300f7bc-2ca6-11e4-8758-42010af0fd79";return e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.post["Content-Type"]="application/json",a.parents=function(){var a=s.defer();return e({method:"get",url:t+"category?key="+l,responseType:"json"}).success(a.resolve).error(a.reject),a.promise},a}]),angular.module("acesTester").controller("MainCtrl",["lookupFactory","searchFactory","categoryFactory","$scope","$http","$sce",function(e,s,a,t,l,i){Array.prototype.unique=function(){for(var e=this.concat(),s=0;s<e.length;++s)for(var a=s+1;a<e.length;++a)e[s]===e[a]&&e.splice(a--,1);return e},t.search_result={},t.parent_categories=[],t.years=[],t.makes=[],t.models=[],t.submodels=[],t.configurations=[],t.filters=[],t.filtered=[],t.parts=[],t.displayable=[],t.getMakes=function(){t.makes=[],t.models=[],t.submodels=[],t.parts=[],t.filters=[],t.configurations=[],t.vehicle={base:{year:parseInt($(".years").val(),0)}},localStorage.setItem("vehicle",JSON.stringify(t.vehicle)),e.query(t.vehicle).then(function(e){void 0!==e.available_makes&&null!==e.available_makes&&(t.makes=e.available_makes)})},t.getModels=function(){t.models=[],t.submodels=[],t.parts=[],t.configurations=[],t.filters=[],t.vehicle={base:{year:parseInt($(".years").val(),0),make:$(".makes").val()}},localStorage.setItem("vehicle",JSON.stringify(t.vehicle)),e.query(t.vehicle).then(function(e){void 0!==e.available_models&&null!==e.available_models&&(t.models=e.available_models)})},t.getSubmodels=function(){t.submodels=[],t.parts=[],t.configurations=[],t.vehicle={base:{year:parseInt($(".years").val(),0),make:$(".makes").val(),model:$(".models").val()}},localStorage.setItem("vehicle",JSON.stringify(t.vehicle)),e.query(t.vehicle).then(function(e){t.submodels=[],void 0!==e.available_submodels&&null!==e.available_submodels&&(t.submodels=e.available_submodels),t.parts=[],t.search_result={},void 0!==e.parts&&null!==e.parts&&(t.parts=e.parts),t.filters=[],void 0!==e.filter&&null!==e.filter&&(t.filters=e.filter)})},t.getConfigurations=function(s){t.configurations=[],t.vehicle={base:{year:parseInt($(".years").val(),0),make:$(".makes").val(),model:$(".models").val()},submodel:$(".submodels").val()},localStorage.setItem("vehicle",JSON.stringify(t.vehicle)),e.query(t.vehicle).then(function(e){void 0!==e.available_configurations&&null!==e.available_configurations&&(t.configurations=e.available_configurations),t.parts=[],t.search_result={},void 0!==e.parts&&null!==e.parts&&(t.parts=e.parts),t.filters=[],void 0!==e.filter&&null!==e.filter&&(t.filters=e.filter)}),s&&s()},t.updateConfiguration=function(){t.vehicle={base:{year:parseInt($(".years").val(),0),make:$(".makes").val(),model:$(".models").val()},submodel:$(".submodels").val(),configurations:[]};var s={year:t.vehicle.base.year,make:t.vehicle.base.make,model:t.vehicle.base.model,submodel:t.vehicle.submodel};angular.forEach($(".config").get(),function(e){s[$(e).data("type")]=$(e).val(),t.vehicle.configurations.push({type:$(e).data("type"),value:$(e).val()})}),localStorage.setItem("vehicle",JSON.stringify(t.vehicle)),e.query(t.vehicle).then(function(e){t.parts=[],t.search_result={},void 0!==e.parts&&null!==e.parts&&(t.parts=e.parts),t.filters=[],void 0!==e.filter&&null!==e.filter&&(t.filters=e.filter)})},t.updateFilter=function(){t.triggerDigest()},t.triggerDigest=function(){},t.search=function(e){var a=$(e.currentTarget).find("input").val();s.query(a).then(function(e){t.search_result=e,console.log(e),t.filters=[],t.filtered=[],t.parts=[],t.displayable=[]})},t.getPrice=function(e){return void 0===e||null===e.Pricing&&null===e.Customer?"":void 0!==e.Customer&&void 0!==e.Customer.Price&&e.Customer.Price>0?"$"+e.Customer.Price:(angular.forEach(e.Pricing,function(e){return"List"===e.Type?"$"+e.Price:void 0}),"Call for Price")},t.getUPC=function(e){if(void 0===e||void 0===e.Attributes||null===e.Attributes)return"";for(var s=0;s<e.Attributes.length;s++)if("UPC"===e.Attributes[s].Key)return e.Attributes[s].Value},t.getImages=function(e,s){var a=[];if(void 0===e||void 0===e.Images||null===e.Images)return a;for(var t=0;t<e.Images.length;t++)if(e.Images[t].Size===s){var l=e.Images[t].Path;a.push(l.Scheme+"://"+l.Host+l.Path)}return a},t.getInstall=function(e){return void 0===e||void 0===e.InstallSheet||null===e.InstallSheet?"#":e.InstallSheet.Scheme+"://"+e.InstallSheet.Host+e.InstallSheet.Path},t.getVideo=function(e){if(void 0===e||void 0===e.Videos||null===e.Videos||0===e.Videos.length)return"";for(var s=null,a=e.Videos.length-1;a>=0;a--)if(e.Videos[a].IsPrimary){s=e.Videos[a];break}if(null===s){var t=Math.floor(Math.random()*(e.Videos.length-1));s=e.Videos[t]}return i.trustAsHtml('<iframe width="100%" height="200" src="//www.youtube.com/embed/'+s.YouTubeVideoId+'" frameborder="0" allowfullscreen></iframe>')},t.loadFromStorage=function(){t.vehicle=JSON.parse(localStorage.getItem("vehicle")),e.query({}).then(function(s){void 0!==s.available_years&&null!==s.available_years&&(t.years=s.available_years,setTimeout(function(){$(".years").val(t.vehicle.base.year.toString()),e.query({base:{year:t.vehicle.base.year}}).then(function(s){void 0!==s.available_makes&&null!==s.available_makes&&(t.makes=s.available_makes,setTimeout(function(){$(".makes").val(t.vehicle.base.make),e.query({base:{year:t.vehicle.base.year,make:t.vehicle.base.make}}).then(function(s){void 0!==s.available_models&&null!==s.available_models&&(t.models=s.available_models,setTimeout(function(){$(".models").val(t.vehicle.base.model),e.query({base:{year:t.vehicle.base.year,make:t.vehicle.base.make,model:t.vehicle.base.model}}).then(function(e){void 0!==e.available_submodels&&null!==e.available_submodels&&(t.submodels=e.available_submodels,setTimeout(function(){$(".submodels").val(t.vehicle.submodel);var e=t.vehicle.configurations;t.getConfigurations(function(){void 0!==e&&setTimeout(function(){for(var s=e.length-1;s>=0;s--){var a=e[s];$('select[data-type="'+a.type+'"]').val(a.value)}localStorage.setItem("vehicle",JSON.stringify(t.vehicle))},1e3)})},100))})},100))})},100))})},100))})},t.showImage=function(e,s,a){var t=$(a.currentTarget).closest(".images").find("img"),l=$(t[0]).attr("src");$(t[0]).attr("src",$(a.currentTarget).attr("src")),$(a.currentTarget).attr("src",l)},""===localStorage.getItem("vehicle")||null===localStorage.getItem("vehicle")?(t.vehicle={base:{year:"- Select Year -",make:"- Select Make -",model:"- Select Model -"}},e.query(t.vehicle).then(function(e){void 0!==e.available_years&&null!==e.available_years&&(t.years=e.available_years)})):t.loadFromStorage(),a.parents().then(function(e){t.parent_categories=e}),$(document).on("touch click",".main-nav .menu-item",function(){$(this).find(".dropdown").slideToggle()})}]),angular.module("acesTester").controller("SearchCtrl",[function(){}]),function(e){try{e=angular.module("acesTester")}catch(s){e=angular.module("acesTester",[])}e.run(["$templateCache",function(e){e.put("partials/main.html",'<div class="container-fluid main-menu"><ul class="main-nav col-lg-2 col-md-2"><li class="menu-item">Products<div class="triangle-down"></div><ul class="dropdown"><li ng-repeat="cat in parent_categories"><img src="getCategoryImag" alt=""> {{cat.Title}}</li></ul></li></ul><div class="main-search col-lg-10 col-md-10"><form role="form" ng-submit="search($event)"><div class="input-group"><input type="search" class="form-control" placeholder="Search"><div class="input-group-btn"><button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search"></span></button></div></div></form></div></div><div class="row"><div class="col-lg-6 lookup"><h3>Select Vehicle</h3><div class="row"><select class="form-control years" ng-model="vehicle.base.year" ng-change="getMakes()"><option value="0">- Select Year -</option><option value="{{year}}" ng-repeat="year in years">{{year}}</option></select></div><div class="row"><select class="form-control makes" ng-model="vehicle.base.make" ng-change="getModels()"><option value="0">- Select Make -</option><option value="{{make}}" ng-repeat="make in makes">{{make}}</option></select></div><div class="row"><select class="form-control models" ng-model="vehicle.base.model" ng-change="getSubmodels()"><option value="0">- Select Model -</option><option value="{{model}}" ng-repeat="model in models">{{model}}</option></select></div><div class="row" ng-if="submodels.length > 0"><select class="form-control submodels" ng-model="submodel" ng-change="getConfigurations()"><option value="0">- Select Submodel -</option><option value="{{sub}}" ng-repeat="sub in submodels">{{sub}}</option></select></div><div class="configurations"><div class="row" ng-repeat="config in configurations"><select class="form-control config" data-type="{{config.type}}" ng-if="config.options.length > 0" ng-model="configuration" ng-change="updateConfiguration()"><option value="">- Select {{config.type}} -</option><option value="{{opt}}" ng-repeat="opt in config.options">{{opt}}</option></select></div></div></div></div><div class="row" ng-if="parts.length > 0"><div class="accordion-heading hidden-md hidden-lg"><a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Filter Options</a></div><div class="col-lg-3 col-md-3 well filters" ng-if="filters.length > 0"><div class="filter-segment" ng-repeat="filter in filters | filterResults:this"><span class="title">{{filter.Key}}</span><ul><li ng-repeat="(i, opt) in filter.Options" data-id="{{i}}"><input type="checkbox" ng-checked="opt.Selected" ng-click="updateFilter(filter, i, $event)">{{opt.Value}} ( {{opt.Products.length}} )</li></ul></div></div><div class="col-lg-8 col-md-8 col-offset-lg-1"><h3 ng-if="parts.length > 0">Matched Parts</h3><div class="results" ng-if="parts.length > 0"><div class="result" ng-repeat="part in parts | matchedParts:this" ng-model="part" data-id="{{part.PartId}}"><div class="heading"><p class="title pull-left hidden-xs hidden-sm">{{part.ShortDesc}}</p><p class="title hidden-md hidden-lg">{{part.ShortDesc}}</p><div class="hidden-xs hidden-sm pull-right values"><span class="class"><strong>Class</strong>: {{part.PartClass}}</span> <span class="upc"><strong>UPC</strong>: {{getUPC(part)}}</span></div></div><div class="row"><div class="col-lg-5 col-md-5 images hidden-sm hidden-xs"><img class="partImage" ng-src="{{img}}" ng-click="showImage(i, part, $event)" alt="{{part.ShortDesc}} Image {{i}}" ng-repeat="(i, img) in getImages(part, \'Grande\')"></div><div class="col-lg-6 col-md-6 col-offset-lg-1 body hidden-sm hidden-xs"><div class="actions well"><span class="price">{{getPrice(part)}}</span> <a href="#/part/{{part.PartId}}" class="btn btn-default">Add to Cart</a> <a href="getInstall(part)" class="install"><span class="glyphicon glyphicon-wrench"></span> Install Sheet</a><div class="video" ng-bind-html="getVideo(part)"></div></div><div class="content"><p ng-repeat="con in part.Content">{{con.Value}}</p></div><table class="attr-table"><tbody><tr ng-repeat="attr in part.Attributes"><td>{{attr.Key}}</td><td>{{attr.Value}}</td></tr></tbody></table></div><div class="mb-images images hidden-md hidden-lg"><img class="partImage" ng-src="{{img}}" ng-click="showImage(i, part, $event)" alt="{{part.ShortDesc}} Image {{i}}" ng-repeat="(i, img) in getImages(part, \'Medio\')"><div class="clearfix"></div></div><div class="mb-actions hidden-md hidden-lg well row"><div class="col-sm-5 col-xs-5"><span class="price">{{getPrice(part)}}</span></div><div class="col-sm-7 col-xs-7"><div class="btn-group"><a href="#/part/{{part.PartId}}" class="btn btn-default"><span class="glyphicon glyphicon-info-sign"></span></a> <a href="getInstall(part)" class="btn btn-default"><span class="glyphicon glyphicon-wrench"></span></a> <a href="getVideoLink(part)" class="btn btn-default"><span class="glyphicon glyphicon-play-circle"></span></a></div></div><div class="clearfix"></div></div></div></div></div></div></div><div class="row search-results" ng-if="search_result.hits !== undefined && search_result.hits.hits.length > 0"><div class="col-lg-12 col-md-12"><div class="row"><div class="col-lg-6 col-md-6"><h3>Search Results</h3></div><div class="col-lg-6 col-md-6 search-result-data hidden-xs hidden-sm"><span class="took"><strong>Took (ms)</strong>: {{search_result.took}}</span> <span class="total-results"><strong>Total Results</strong>: {{search_result.hits.total}}</span> <span class="displayed-results"><strong>Returned Results</strong>: {{search_result.hits.hits.length}}</span></div></div><div class="results"><div class="result" ng-repeat="result in search_result.hits.hits"><div ng-switch="result._type"><div ng-switch-when="part"><div class="heading"><p class="title pull-left hidden-xs hidden-sm">{{result._source.ShortDesc}}</p><p class="title hidden-md hidden-lg">{{result._source.ShortDesc}}</p><div class="hidden-xs hidden-sm pull-right values"><span class="class"><strong>Class</strong>: {{result._source.PartClass}}</span> <span class="upc"><strong>UPC</strong>: {{getUPC(result._source)}}</span> <span class="score"><strong>Score</strong>: {{result._score}}</span></div></div><div class="row"><div class="col-lg-5 col-md-5 images hidden-sm hidden-xs"><img class="partImage" ng-src="{{img}}" ng-click="showImage(i, result._source, $event)" alt="{{result._source.ShortDesc}} Image {{i}}" ng-repeat="(i, img) in getImages(result._source, \'Grande\')"></div><div class="col-lg-6 col-md-6 col-offset-lg-1 body hidden-sm hidden-xs"><div class="actions well"><span class="price">{{getPrice(result._source)}}</span> <a href="#/part/{{result._source.PartId}}" class="btn btn-default">Add to Cart</a> <a href="getInstall(result._source)" class="install"><span class="glyphicon glyphicon-wrench"></span> Install Sheet</a><div class="video" ng-bind-html="getVideo(result._source)"></div></div><div class="content"><p ng-repeat="con in result._source.Content">{{con.Value}}</p></div><table class="attr-table"><tbody><tr ng-repeat="attr in result._source.Attributes"><td>{{attr.Key}}</td><td>{{attr.Value}}</td></tr></tbody></table></div><div class="mb-images images hidden-md hidden-lg"><img class="partImage" ng-src="{{img}}" ng-click="showImage(i, result._source, $event)" alt="{{result._source.ShortDesc}} Image {{i}}" ng-repeat="(i, img) in getImages(result._source, \'Medio\')"><div class="clearfix"></div></div><div class="mb-actions hidden-md hidden-lg well row"><div class="col-sm-5 col-xs-5"><span class="price">{{getPrice(result._source)}}</span></div><div class="col-sm-7 col-xs-7"><div class="btn-group"><a href="#/part/{{result._source.PartId}}" class="btn btn-default"><span class="glyphicon glyphicon-info-sign"></span></a> <a href="getInstall(result._source)" class="btn btn-default"><span class="glyphicon glyphicon-wrench"></span></a> <a href="getVideoLink(result._source)" class="btn btn-default"><span class="glyphicon glyphicon-play-circle"></span></a></div></div><div class="clearfix"></div></div></div></div><div ng-switch-when="category"><div class="heading"><p class="title pull-left hidden-xs hidden-sm">{{result._source.Title}}</p><p class="title hidden-md hidden-lg">{{result._source.Title}}</p><div class="hidden-xs hidden-sm pull-right values"><span class="score"><strong>Score</strong>: {{result._score}}</span></div></div><div class="row"><div class="col-lg-5 col-md-5 images hidden-sm hidden-xs"><img class="partImage" ng-src="{{result._source.Image.Scheme}}://{{result._source.Image.Host}}{{result._source.Image.Path}}"></div><div class="col-lg-6 col-md-6 col-offset-lg-1 body hidden-sm hidden-xs"><div class="content"><p>{{result._source.ShortDesc}}</p><p>{{result._source.LongDesc}}</p></div></div><div class="mb-images images hidden-md hidden-lg"><img class="partImage" ng-src="{{result._source.Image.Scheme}}://{{result._source.Image.Host}}{{result._source.Image.Path}}"><div class="clearfix"></div></div><div class="mb-actions hidden-md hidden-lg row"><p>{{result._source.ShortDesc}}</p><p>{{result._source.LongDesc}}</p></div></div></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("acesTester")}catch(s){e=angular.module("acesTester",[])}e.run(["$templateCache",function(e){e.put("partials/search.html","<p>Search Results go here</p>")}])}();